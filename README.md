# Aitrics Vital Signs Project

Aitrics Vital Signs í”„ë¡œì íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” í™˜ìžì˜ ë°”ì´íƒˆ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê³  ë¶„ì„í•˜ëŠ” API ì„œë²„ìž…ë‹ˆë‹¤.

## ðŸ— í”„ë¡œì íŠ¸ íŒ¨í‚¤ì§€ êµ¬ì¡°

```text
.
â”œâ”€â”€ api-server                # ë©”ì¸ API ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ app                   # ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë° í•¸ë“¤ëŸ¬)
â”‚   â”‚   â”œâ”€â”€ controller        # HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ repository        # ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ë‹´ë‹¹í•˜ëŠ” ë ˆí¬ì§€í† ë¦¬ ë ˆì´ì–´
â”‚   â”‚   â”œâ”€â”€ router            # API ì—”ë“œí¬ì¸íŠ¸ ë° ë¼ìš°íŒ… ì„¤ì •
â”‚   â”‚   â””â”€â”€ service           # ë„ë©”ì¸ ë¡œì§ ë° ì„œë¹„ìŠ¤ ë¡œì§ (Optimistic Lock ì ìš©)
â”‚   â”œâ”€â”€ cmd                   # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ìž…ì  (main.go ìœ„ì¹˜)
â”‚   â”œâ”€â”€ ddl                   # ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì •ì˜ SQL íŒŒì¼
â”‚   â”œâ”€â”€ docs                  # Swagger API ë¬¸ì„œ ìžë™ ìƒì„± íŒŒì¼
â”‚   â”œâ”€â”€ domain                # ë„ë©”ì¸ ëª¨ë¸ ë° ì¸í„°íŽ˜ì´ìŠ¤ ì •ì˜
â”‚   â””â”€â”€ internal              # ì„œë²„ ë‚´ë¶€ ìœ í‹¸ë¦¬í‹° ë° ì´ˆê¸°í™” ì½”ë“œ
â”œâ”€â”€ library                   # ê³µí†µ ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ envs                  # í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ë° ê´€ë¦¬
â”‚   â”œâ”€â”€ error                 # ê³µí†µ ì—ëŸ¬ í•¸ë“¤ë§ ë° ëž˜í•‘ ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ logger                # ì •í˜•í™”ëœ ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬
â”œâ”€â”€ docker-compose.yaml       # ë¡œì»¬ ê°œë°œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì¸í”„ë¼ êµ¬ì„±
â””â”€â”€ Dockerfile                # API ì„œë²„ ì»¨í…Œì´ë„ˆ ë¹Œë“œ ì •ì˜
```

## ðŸš€ ì‹¤í–‰ ë°©ë²•

### 1. Docker Composeë¥¼ í†µí•œ ì‹¤í–‰ (ê¶Œìž¥)
ê°€ìž¥ ë¹ ë¥´ê³  ê°„íŽ¸í•˜ê²Œ ì „ì²´ ì‹œìŠ¤í…œì„ êµ¬ë™í•˜ëŠ” ë°©ë²•ìž…ë‹ˆë‹¤. MySQL ë°ì´í„°ë² ì´ìŠ¤ë„ í•¨ê»˜ ì„¤ì¹˜ ë° êµ¬ì„±ë©ë‹ˆë‹¤.
```bash
docker-compose up -d
```
* MySQLì´ í•¨ê»˜ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰ë˜ë©°, í™˜ê²½ ì„¤ì •ì´ ìžë™ìœ¼ë¡œ ì™„ë£Œë©ë‹ˆë‹¤. êµ¬ë™ë§Œ ì‹œí‚¤ë©´ ë°”ë¡œ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### 2. ë¡œì»¬ í™˜ê²½ì—ì„œ ì§ì ‘ ì‹¤í–‰
Go ê°œë°œ í™˜ê²½ì—ì„œ ì½”ë“œë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ë©° í…ŒìŠ¤íŠ¸í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
* **ì¤€ë¹„ë¬¼**: ë¡œì»¬ í™˜ê²½ í˜¹ì€ ì™¸ë¶€ì˜ `localhost:3306`ì— MySQLì´ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤.
* **ë§ˆì´ê·¸ë ˆì´ì…˜**: ë³„ë„ì˜ DDL ì‹¤í–‰ ì—†ì´ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ ì‹œ í…Œì´ë¸”ì´ ìžë™ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë©ë‹ˆë‹¤. (í•˜ì§€ë§Œ ë„ì»¤ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì„ ê°€ìž¥ ê¶Œìž¥í•©ë‹ˆë‹¤.)
* **ë°©ë²•**: `api-server/example.env` íŒŒì¼ì˜ ì„¤ì •ì„ ì°¸ê³ í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ë¥¼ êµ¬ì„±í•œ í›„ ì•„ëž˜ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
```bash
cd api-server
go run cmd/main.go
```

### 3. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‹¤í–‰
ë³¸ í”„ë¡œì íŠ¸ëŠ” ì½”ë“œ ì»¤ë²„ë¦¬ì§€ 70% ì´ìƒì„ ë§Œì¡±í•˜ë„ë¡ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ì„ ìœ„í•´ **ë°˜ë“œì‹œ `api-server` ë””ë ‰í† ë¦¬ë¡œ ì´ë™**í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
cd api-server
```

* **Patient ë„ë©”ì¸ í…ŒìŠ¤íŠ¸**
```bash
# api-server ë””ë ‰í† ë¦¬ë¡œ ì´ë™ í›„ ì‹¤í–‰
cd api-server && go test ./app/... -v -run Patient
```

* **Vital ë„ë©”ì¸ í…ŒìŠ¤íŠ¸**
```bash
# api-server ë””ë ‰í† ë¦¬ë¡œ ì´ë™ í›„ ì‹¤í–‰
cd api-server && go test ./app/... -v -run Vital
```

* **Inference ë„ë©”ì¸ í…ŒìŠ¤íŠ¸**
```bash
# api-server ë””ë ‰í† ë¦¬ë¡œ ì´ë™ í›„ ì‹¤í–‰ (Risk ê³„ì‚° ê´€ë ¨ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰)
cd api-server && go test ./app/... -v -run Risk
```

* **ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
```bash
# api-server ë””ë ‰í† ë¦¬ë¡œ ì´ë™ í›„ ì‹¤í–‰
cd api-server && go test ./...
```

## ðŸ“– API ë¬¸ì„œ (Swagger)

ì„œë²„ êµ¬ë™ í›„ ë¸Œë¼ìš°ì €ì—ì„œ ì•„ëž˜ ì£¼ì†Œë¡œ ì ‘ì†í•˜ì—¬ API ì‚¬ì–‘ì„ í™•ì¸í•˜ê³  í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
* **Swagger URL**: [https://localhost:8080/swagger/index.html](https://localhost:8080/swagger/index.html)

## ðŸ—„ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (DDL)
![img.png](img.png)

ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì •ì˜ì„œëŠ” ì•„ëž˜ ê²½ë¡œì—ì„œ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
* **Path**: api-server/ddl/aitrics_table.sql

> [!NOTE]
> `vitals` í…Œì´ë¸”ì˜ `patient_id`ëŠ” ë…¼ë¦¬ì ìœ¼ë¡œ `patients` í…Œì´ë¸”ê³¼ ì™¸ëž˜í‚¤(Foreign Key) ê´€ê³„ì— ìžˆì§€ë§Œ, ì‹¤ì œ ìš´ì˜ìƒì˜ ë°ì´í„° ê´€ë¦¬ íŽ¸ì˜ì„±ê³¼ ìœ ì—°ì„±ì„ ìœ„í•˜ì—¬ ë¬¼ë¦¬ì ì¸ ì™¸ëž˜í‚¤ ì œì•½ ì¡°ê±´ì€ ë§ºì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

## ðŸ” Optimistic Lock (ë‚™ê´€ì  ë½) ì ìš©

ë³¸ í”„ë¡œì íŠ¸ì˜ `VitalService`ì—ëŠ” ë°ì´í„° ì •í•©ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ **Optimistic Lock** ê¸°ë²•ì´ ì ìš©ë˜ì–´ ìžˆìŠµë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œ ë²„ì „ ë²ˆí˜¸ë¥¼ ì²´í¬í•˜ì—¬ ì¶©ëŒì„ ë°©ì§€í•˜ëŠ” ë°©ì‹ìž…ë‹ˆë‹¤.

### ë™ìž‘ ì›ë¦¬
1. ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ í˜„ìž¬ì˜ `version` ê°’ì„ í•¨ê»˜ ê°€ì ¸ì˜µë‹ˆë‹¤.
2. ì—…ë°ì´íŠ¸ ìš”ì²­ ì‹œ, í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡°íšŒí–ˆë˜ `version` ê°’ì„ í•¨ê»˜ ì „ë‹¬í•©ë‹ˆë‹¤.
3. ì„œë²„ëŠ” ì „ë‹¬ë°›ì€ `version`ì´ í˜„ìž¬ DBì˜ `version`ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
4. ì¼ì¹˜í•˜ë©´ `version`ì„ 1 ì¦ê°€ì‹œí‚¤ë©° ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³ , ë‹¤ë¥´ë©´ **Conflict** ì—ëŸ¬ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

### íë¦„ë„ (Sequence Diagram)
```text
      Client A                Server/DB                Client B
         |                        |                       |
         |----(1) Read Record---->|                       |
         |      (Version: 1)      |                       |
         |                        |<---(2) Read Record----|
         |                        |      (Version: 1)     |
         |                        |                       |
         |---(3) Update Request-->|                       |
         |      (Version: 1)      |                       |
         |                        |                       |
         |<---(4) Success!------- |                       |
         |      (Version: 2)      |                       |
         |                        |---(5) Update Request--|
         |                        |      (Version: 1)     |
         |                        |                       |
         |                        |<---(6) Conflict! ---- |
         |                        | (DB Version is 2)     |
```
*ìƒì„¸ ë¡œì§ì€ api-server/app/service/vital_service.go ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.*

## AI Agent í™œìš© ê¸°ë¡
- ai-history/AITRICS.md ì˜ ë‚´ìš©ì„ ì°¸ê³ í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.
- ai-history/history ì— CLAUDE ì‚¬ìš©ì—ëŒ€í•œ ì „ë°˜ì ì¸ ë‚´ìš©ì´ ê¸°ë¡ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
- api-server í•˜ìœ„ ê° ë””ë ‰í† ë¦¬ì— CLAUDE.md ë¥¼ ì§€ì •í•˜ê³  ê° ë ˆì´ì–´ì— ëŒ€í•œ ì½”ë“œ ìƒì„± ê·œì¹™ì„ ì •ì˜í•˜ì˜€ìŠµë‹ˆë‹¤.